!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cyberuskey-sdk",[],t):"object"==typeof exports?exports["cyberuskey-sdk"]=t():e["cyberuskey-sdk"]=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CyberusKeyAPI=void 0;t.CyberusKeyAPI=class{constructor(e,t,r=600){this._apiUrl=new URL("/api/v2/",e),this._geoProvider=t,this._delayMs=r}createSession(e,t,r){return n(this,void 0,void 0,(function*(){const n={client_id:e};if(r)n.lat=r.latitude,n.lng=r.longitude;else if(this._geoProvider){const e=yield this._geoProvider.getGeo();e&&(n.lat=e.latitude,n.lng=e.longitude)}t&&(n.origin=t);const o={method:"POST",body:this._getUrlEncodedBody(n),headers:{"Content-Type":"application/x-www-form-urlencoded"}};return fetch(this._getUrl("sessions"),o).then(e=>e.json()).then(e=>e.data.session_id)}))}isOutOfService(){return n(this,void 0,void 0,(function*(){let e=new URL(document.location.href).searchParams.get("error");if(null!=e&&"otp_timeout_error"==e){let e=sessionStorage.getItem("auth_active");if(null!=e&&"true"===e){sessionStorage.removeItem("auth_active");let e=sessionStorage.getItem("auth_counter");if(null!=e){let t=parseInt(e,10);isNaN(t)||sessionStorage.setItem("auth_counter",(t+1).toString())}else sessionStorage.setItem("auth_counter","1")}}else sessionStorage.removeItem("auth_counter");return fetch(this._getUrl("version"),{headers:{Accept:"application/json"}}).then(e=>e.json()).then(e=>e.outOfService).catch(e=>e)}))}getOTPSound(e){const t={headers:{Accept:"audio/mpeg","Content-Type":"text/plain"}};return fetch(this._getUrl("sessions/"+e),t).then(e=>e.arrayBuffer()).then(e=>new Blob([e],{type:"audio/mpeg"})).then(e=>window.URL.createObjectURL(e)).catch(e=>e)}getAuthenticationEndpointUrl(e,t,r,n,o,i,s="code"){const c={session_id:e,client_id:r,scope:t.getValue(),redirect_uri:n,response_type:s};o&&(c.state=o),i&&(c.nonce=i);const u=new URL(this._getUrl("authenticate"));return Object.keys(c).forEach(e=>{u.searchParams.append(e,c[e])}),u.href}navigateAuthentication(e,t,r,n,o,i,s,c,u="code"){const a=this.getAuthenticationEndpointUrl(o,r,e,t,s,c,u);return sessionStorage.setItem("auth_active","true"),n.navigate(a)}loginThroughCyberusKeyDashboard(e){return n(this,void 0,void 0,(function*(){const t={client_id:e.clientId,scope:e.scope.getValue(),redirect_uri:e.redirectUri,response_type:e.responseType,state:e.state,nonce:e.nonce,display:e.display||"page",prompt:e.prompt,theme:e.theme};e.state&&(t.state=e.state),e.nonce&&(t.nonce=e.nonce);const r=new URL(this._getUrl("authenticate"));Object.keys(t).forEach(e=>{r.searchParams.append(e,t[e])}),yield e.navigator.navigate(r.href)}))}_getUrl(e){return new URL(e,this._apiUrl).href}_getUrlEncodedBody(e){return Object.keys(e).reduce((t,r)=>{const n=encodeURIComponent(r),o=encodeURIComponent(e[r]);return t.push(`${n}=${o}`),t},[]).join("&")}_timeout(e){return new Promise(t=>setTimeout(t,e))}}},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRedirectUri=t.OTPGenerationError=t.ResourceNotFoundError=t.OpenApiError=t.WrongJsonError=t.TooManyCallsError=t.UnknownError=t.CyberusKeyError=t.ErrorCode=t.errorFactory=void 0,function(e){e[e[void 0]=1]="undefined",e[e.unknown_error=2]="unknown_error",e[e.server_error=3]="server_error",e[e.wrong_json=4]="wrong_json",e[e.openapi_error=5]="openapi_error",e[e.resource_not_found=6]="resource_not_found",e[e.otp_generation_failure=7]="otp_generation_failure",e[e.invalid_redirect_uri=8]="invalid_redirect_uri",e[e.invalid_client=9]="invalid_client",e[e.too_many_calls_error=10]="too_many_calls_error"}(n||(n={})),t.ErrorCode=n;class o extends Error{constructor(e,t){super(t),this._code=n[e]}get code(){return n[this._code]}get description(){return this.message}}t.CyberusKeyError=o;class i extends o{constructor(e="unknown_error",t="Unknown error occured."){super(e,t)}}t.UnknownError=i;class s extends o{constructor(e="too_many_calls_error",t="You've done too many calls."){super(e,t)}}t.TooManyCallsError=s;t.MissingRedirectUri=class extends o{constructor(){super("invalid_redirect_uri","Missing redirection URI.")}};class c extends o{}t.WrongJsonError=c;class u extends o{}t.OpenApiError=u;class a extends o{}t.ResourceNotFoundError=a;class d extends o{}t.OTPGenerationError=d;const l={[n.undefined]:i,[n.unknown_error]:i,[n.server_error]:i,[n.undefined]:c,[n.wrong_json]:c,[n.openapi_error]:u,[n.resource_not_found]:a,[n.otp_generation_failure]:d,[n.invalid_redirect_uri]:class extends o{},[n.invalid_client]:class extends o{},[n.too_many_calls_error]:s};t.errorFactory=function(e,t){const r=n[e];return new(0,l[r])(e,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Geolocation=void 0;t.Geolocation=class{constructor(e,t,r){this._latitude=e,this._longitude=t,this._accuracy=r}get latitude(){return this._latitude}get longitude(){return this._longitude}get accuracy(){return this._accuracy}}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(0),t),o(r(1),t),o(r(4),t),o(r(5),t),o(r(6),t),o(r(7),t),o(r(2),t),o(r(8),t),o(r(9),t),o(r(10),t);const i=r(0);t.default=i.CyberusKeyAPI},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RedirectNavigator=void 0;const o=r(1);t.RedirectNavigator=class{navigate(e){return n(this,void 0,void 0,(function*(){if(!e)throw new o.MissingRedirectUri;return window.location.href=e,Promise.resolve()}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenIdScopeParser=void 0;t.OpenIdScopeParser=class{constructor(){this._scope=["openid"]}addEmail(){return this._scope.includes("email")||this._scope.push("email"),this}addProfile(){return this._scope.includes("profile")||this._scope.push("profile"),this}getValue(){return this._scope.join(" ")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;t.Session=class{constructor(e){this.sessionId=e.session_id,this.createdAt=new Date(e.created_at)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HTML5GeoProvider=void 0;const o=r(2);t.HTML5GeoProvider=class{constructor(e=!1,t=null,r=2,n=window.navigator){this._numOfTriesBeforeGpsActivates=2,this.defaultMessage="Cyberus Key widget would like to access your location to use geolocation tracking to assert successful authentication.",this._enableHighAccuracy=e,this._navigator=n,this._numOfTriesBeforeGpsActivates=r,this._onPermissionDialog=t}getGeo(){return n(this,void 0,void 0,(function*(){const e=yield navigator.permissions.query({name:"geolocation"});try{if("granted"==e.state)return yield this._getGeo(this._enableHighAccuracy);if("denied"==e.state)return null;if("prompt"==e.state)return this._doIShowCustomPrompt()?(this._onPermissionDialog?this._onPermissionDialog(this.defaultMessage):alert(this.defaultMessage),yield this._getGeo(this._enableHighAccuracy)):null}catch(e){return null}}))}_doIShowCustomPrompt(){let e=sessionStorage.getItem("auth_counter");if(null==e)return!1;let t=parseInt(e,10);return!isNaN(t)&&t>=this._numOfTriesBeforeGpsActivates}_getGeo(e){return n(this,void 0,void 0,(function*(){const{coords:t}=yield new Promise((t,r)=>{this._navigator.geolocation.getCurrentPosition(t,r,{enableHighAccuracy:e})});return new o.Geolocation(t.latitude,t.longitude,t.accuracy)}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginOptions=void 0;t.LoginOptions=class{constructor(){this.responseType="code",this.display="page",this.prompt="login,none",this.theme="default"}}}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jeWJlcnVza2V5LXNkay93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vY3liZXJ1c2tleS1zZGsvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vY3liZXJ1c2tleS1zZGsvLi9zcmMvc2RrL2FwaS50cyIsIndlYnBhY2s6Ly9jeWJlcnVza2V5LXNkay8uL3NyYy9zZGsvZXJyb3JzLnRzIiwid2VicGFjazovL2N5YmVydXNrZXktc2RrLy4vc3JjL3Nkay9nZW9Qcm92aWRlci9nZW8udHMiLCJ3ZWJwYWNrOi8vY3liZXJ1c2tleS1zZGsvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vY3liZXJ1c2tleS1zZGsvLi9zcmMvc2RrL25hdmlnYXRvci9yZWRpcmVjdE5hdmlnYXRvci50cyIsIndlYnBhY2s6Ly9jeWJlcnVza2V5LXNkay8uL3NyYy9zZGsvc2NvcGVQYXJzZXIudHMiLCJ3ZWJwYWNrOi8vY3liZXJ1c2tleS1zZGsvLi9zcmMvc2RrL3Nlc3Npb24udHMiLCJ3ZWJwYWNrOi8vY3liZXJ1c2tleS1zZGsvLi9zcmMvc2RrL2dlb1Byb3ZpZGVyL2h0bWw1R2VvUHJvdmlkZXIudHMiLCJ3ZWJwYWNrOi8vY3liZXJ1c2tleS1zZGsvLi9zcmMvc2RrL2xvZ2luT3B0aW9ucy50cyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ3aW5kb3ciLCJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiaG9zdFVybCIsImdlb1Byb3ZpZGVyIiwiZGVsYXlNcyIsInRoaXMiLCJfYXBpVXJsIiwiVVJMIiwiX2dlb1Byb3ZpZGVyIiwiX2RlbGF5TXMiLCJjbGllbnRJZCIsIm9yaWdpbiIsImdlbyIsImRhdGEiLCJjbGllbnRfaWQiLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsImdwcyIsImdldEdlbyIsInBhcmFtcyIsIm1ldGhvZCIsImJvZHkiLCJfZ2V0VXJsRW5jb2RlZEJvZHkiLCJoZWFkZXJzIiwiZmV0Y2giLCJfZ2V0VXJsIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsInNlc3Npb25faWQiLCJlcnJQYWdlTXNnIiwiZG9jdW1lbnQiLCJsb2NhdGlvbiIsImhyZWYiLCJzZWFyY2hQYXJhbXMiLCJhdXRoQWN0aXZlIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwicmVtb3ZlSXRlbSIsImF1dGhDb3VudGVyIiwiYXV0aENvdW50ZXJWYWx1ZSIsInBhcnNlSW50IiwiaXNOYU4iLCJzZXRJdGVtIiwidG9TdHJpbmciLCJ2ZXJzaW9uSnNvbiIsIm91dE9mU2VydmljZSIsImNhdGNoIiwiZXJyIiwic2Vzc2lvbiIsInJlcXVlc3RPcHRpb25zIiwiYXJyYXlCdWZmZXIiLCJCbG9iIiwidHlwZSIsImJsb2IiLCJjcmVhdGVPYmplY3RVUkwiLCJzZXNzaW9uSWQiLCJzY29wZSIsInJlZGlyZWN0VXJpIiwic3RhdGUiLCJub25jZSIsInJlc3BvbnNlVHlwZSIsImdldFZhbHVlIiwicmVkaXJlY3RfdXJpIiwicmVzcG9uc2VfdHlwZSIsInVybCIsImtleXMiLCJmb3JFYWNoIiwicGFyYW1ldGVyTmFtZSIsImFwcGVuZCIsIm5hdmlnYXRvciIsImF1dGhlbnRpY2F0ZVVybCIsImdldEF1dGhlbnRpY2F0aW9uRW5kcG9pbnRVcmwiLCJuYXZpZ2F0ZSIsIm9wdGlvbnMiLCJkaXNwbGF5IiwicHJvbXB0IiwidGhlbWUiLCJwYXRoIiwicmVkdWNlIiwicmVzdWx0IiwiZW5jb2RlZEtleSIsImVuY29kZVVSSUNvbXBvbmVudCIsImVuY29kZWRWYWx1ZSIsInB1c2giLCJqb2luIiwibXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJFcnJvckNvZGUiLCJDeWJlcnVzS2V5RXJyb3IiLCJFcnJvciIsImNvZGUiLCJtZXNzYWdlIiwic3VwZXIiLCJfY29kZSIsIlVua25vd25FcnJvciIsIlRvb01hbnlDYWxsc0Vycm9yIiwiTWlzc2luZ1JlZGlyZWN0VXJpIiwiV3JvbmdKc29uRXJyb3IiLCJPcGVuQXBpRXJyb3IiLCJSZXNvdXJjZU5vdEZvdW5kRXJyb3IiLCJPVFBHZW5lcmF0aW9uRXJyb3IiLCJNQVBQSU5HIiwidW5kZWZpbmVkIiwidW5rbm93bl9lcnJvciIsInNlcnZlcl9lcnJvciIsIndyb25nX2pzb24iLCJvcGVuYXBpX2Vycm9yIiwicmVzb3VyY2Vfbm90X2ZvdW5kIiwib3RwX2dlbmVyYXRpb25fZmFpbHVyZSIsImludmFsaWRfcmVkaXJlY3RfdXJpIiwiaW52YWxpZF9jbGllbnQiLCJ0b29fbWFueV9jYWxsc19lcnJvciIsImVycm9yRmFjdG9yeSIsImVudW1fdHlwZSIsIkVycm9yQ29uc3RydWN0b3IiLCJhY2N1cmFjeSIsIl9sYXRpdHVkZSIsIl9sb25naXR1ZGUiLCJfYWNjdXJhY3kiLCJDeWJlcnVzS2V5QVBJIiwiX3Njb3BlIiwiaW5jbHVkZXMiLCJjcmVhdGVkQXQiLCJEYXRlIiwiY3JlYXRlZF9hdCIsImVuYWJsZUhpZ2hBY2N1cmFjeSIsIm9uUGVybWlzc2lvbkRpYWxvZyIsIm51bU9mVHJpZXNCZWZvcmVHcHNBY3RpdmF0ZXMiLCJfbnVtT2ZUcmllc0JlZm9yZUdwc0FjdGl2YXRlcyIsImRlZmF1bHRNZXNzYWdlIiwiX2VuYWJsZUhpZ2hBY2N1cmFjeSIsIl9uYXZpZ2F0b3IiLCJfb25QZXJtaXNzaW9uRGlhbG9nIiwicGVybWlzc2lvblN0YXR1cyIsInBlcm1pc3Npb25zIiwicXVlcnkiLCJfZ2V0R2VvIiwiX2RvSVNob3dDdXN0b21Qcm9tcHQiLCJhbGVydCIsImUiLCJjb29yZHMiLCJyZWplY3QiLCJnZW9sb2NhdGlvbiIsImdldEN1cnJlbnRQb3NpdGlvbiIsIkdlb2xvY2F0aW9uIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUEyQ0EsRUFBTUMsR0FDMUIsaUJBQVpDLFNBQTBDLGlCQUFYQyxPQUN4Q0EsT0FBT0QsUUFBVUQsSUFDUSxtQkFBWEcsUUFBeUJBLE9BQU9DLElBQzlDRCxPQUFPLGlCQUFrQixHQUFJSCxHQUNILGlCQUFaQyxRQUNkQSxRQUFRLGtCQUFvQkQsSUFFNUJELEVBQUssa0JBQW9CQyxJQVIzQixDQVNHSyxRQUFRLFdBQ1gsTyxZQ1RFLElBQUlDLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVQLFFBR25DLElBQUlDLEVBQVNJLEVBQWlCRSxHQUFZLENBQ3pDQyxFQUFHRCxFQUNIRSxHQUFHLEVBQ0hULFFBQVMsSUFVVixPQU5BVSxFQUFRSCxHQUFVSSxLQUFLVixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTTSxHQUcvREwsRUFBT1EsR0FBSSxFQUdKUixFQUFPRCxRQTBEZixPQXJEQU0sRUFBb0JNLEVBQUlGLEVBR3hCSixFQUFvQk8sRUFBSVIsRUFHeEJDLEVBQW9CUSxFQUFJLFNBQVNkLEVBQVNlLEVBQU1DLEdBQzNDVixFQUFvQlcsRUFBRWpCLEVBQVNlLElBQ2xDRyxPQUFPQyxlQUFlbkIsRUFBU2UsRUFBTSxDQUFFSyxZQUFZLEVBQU1DLElBQUtMLEtBS2hFVixFQUFvQmdCLEVBQUksU0FBU3RCLEdBQ1gsb0JBQVh1QixRQUEwQkEsT0FBT0MsYUFDMUNOLE9BQU9DLGVBQWVuQixFQUFTdUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlbkIsRUFBUyxhQUFjLENBQUV5QixPQUFPLEtBUXZEbkIsRUFBb0Jv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c0JBRUYvSCxLQUFLc0ksUUFBUXRJLEtBQUtnSSxzQkFQcEIsS0FVakIsTUFBT1MsR0FDTCxPQUFPLFNBS2YsdUJBQ0ksSUFBSWpJLEVBQU91QixlQUFlQyxRQUFRLGdCQUNsQyxHQUFZLE1BQVJ4QixFQUNBLE9BQU8sRUFFWCxJQUFJMUIsRUFBUXNELFNBQVM1QixFQUFNLElBRTNCLE9BQVE2QixNQUFNdkQsSUFBVUEsR0FBU2tCLEtBQUs4SCw4QkFLcEMsUUFBUUgsRyx5Q0FDVixNQUFNLE9BQUNlLFNBQWdCLElBQUl4RCxRQUFRLENBQUNDLEVBQVN3RCxLQUN6QzNJLEtBQUtpSSxXQUFXVyxZQUFZQyxtQkFBbUIxRCxFQUFTd0QsRUFBUSxDQUFDaEIseUJBR3JFLE9BQU8sSUFBSSxFQUFBbUIsWUFBWUosRUFBT2hJLFNBQVVnSSxFQUFPL0gsVUFBVytILEVBQU96QixnQixvR0NuRnpFLG1DQXVFVyxLQUFBekQsYUFBdUIsT0FTdkIsS0FBQWMsUUFBa0IsT0FVbEIsS0FBQUMsT0FBaUIsYUFRakIsS0FBQUMsTUFBZ0IiLCJmaWxlIjoic2RrLmVzNi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImN5YmVydXNrZXktc2RrXCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcImN5YmVydXNrZXktc2RrXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImN5YmVydXNrZXktc2RrXCJdID0gZmFjdG9yeSgpO1xufSkod2luZG93LCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMyk7XG4iLCJpbXBvcnQge0dlb2xvY2F0aW9ufSBmcm9tICcuL2dlb1Byb3ZpZGVyL2dlbyc7XHJcbmltcG9ydCB7R2VvUHJvdmlkZXJ9IGZyb20gJy4vZ2VvUHJvdmlkZXIvZ2VvUHJvdmlkZXInO1xyXG5pbXBvcnQge05hdmlnYXRvcn0gZnJvbSAnLi9uYXZpZ2F0b3IvbmF2aWdhdG9yJztcclxuaW1wb3J0IHtPcGVuSWRTY29wZVBhcnNlcn0gZnJvbSAnLi9zY29wZVBhcnNlcic7XHJcbmltcG9ydCB7U2Vzc2lvbn0gZnJvbSAnLi9zZXNzaW9uJztcclxuaW1wb3J0IHtMb2dpbk9wdGlvbnN9IGZyb20gJy4vbG9naW5PcHRpb25zJztcclxuXHJcblxyXG4vKipcclxuICogQ3liZXJ1cyBLZXkgQVBJIHdoaWNoIGFsbG93cyB5b3UgdG8gZG8gYSBkZWxlZ2F0ZSBsb2dpbiB3aXRoIE9wZW5JZCBwcm90b2NvbC5cclxuICpcclxuICogQGNsYXNzIEN5YmVydXNLZXlBUElcclxuICovXHJcbmV4cG9ydCBjbGFzcyBDeWJlcnVzS2V5QVBJIHtcclxuICAgIHByaXZhdGUgX2FwaVVybDogVVJMO1xyXG4gICAgcHJpdmF0ZSBfZ2VvUHJvdmlkZXI6IEdlb1Byb3ZpZGVyO1xyXG4gICAgcHJpdmF0ZSBfZGVsYXlNczogbnVtYmVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICpDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEN5YmVydXNLZXlBUEkuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaG9zdFVybCBCYXNlIFVSTCBvZiB0aGUgaG9zdCBzZXJ2ZXIsIGUuZy4gYGh0dHBzOi8vYXBpLmN5YmVydXNrZXkuY29tYFxyXG4gICAgICogQHBhcmFtIHtHZW9Qcm92aWRlcn0gW2dlb1Byb3ZpZGVyXSBHZW9sb2NhbGl6YXRpb24gcHJvdmlkZXIuIFVzZSBzcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBsaWtlIGBIVE1MNUdlb1Byb3ZpZGVyYC5cclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbZGVsYXlNcz02MDBdIERlbGF5IChtcykgYmV0d2VlbiBtYWtpbmcgYW4gQXV0aGVudGljYXRpb24gcmVxdWVzdCBhbmQgYSBzb3VuZCBwbGF5aW5nLlxyXG4gICAgICogQG1lbWJlcm9mIEN5YmVydXNLZXlBUElcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoaG9zdFVybDogc3RyaW5nLCBnZW9Qcm92aWRlcj86IEdlb1Byb3ZpZGVyLCBkZWxheU1zOiBudW1iZXIgPSA2MDApIHtcclxuICAgICAgICB0aGlzLl9hcGlVcmwgPSBuZXcgVVJMKCcvYXBpL3YyLycsIGhvc3RVcmwpO1xyXG4gICAgICAgIHRoaXMuX2dlb1Byb3ZpZGVyID0gZ2VvUHJvdmlkZXI7XHJcbiAgICAgICAgdGhpcy5fZGVsYXlNcyA9IGRlbGF5TXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIHRoZSBDeWJlcnVzIEtleSBzZXNzaW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCBQdWJsaWMgY2xpZW50IElEIGdlbmVyYXRlZCBkdXJpbmcgY3JlYXRpbmcgdGhlIGFjY291bnQuXHJcbiAgICAgKiBAcGFyYW0ge0dlb2xvY2F0aW9ufSBbZ2VvXSBHaXZlIGEgdmFsdWUgaWYgeW91IHdhbnQgdG8gcGFzcyBvcHRpb25hbCBnZW9sb2NhdGlvbiBtZWFzdXJlbWVudC5cclxuICAgICAqICAgIEl0IGNhbiBiZSBsYXRlciB1c2UgdG8gY29tcGFyZSBpdCBhZ2FpbnN0IHRoZSBtb2JpbGUncyBtZWFzdXJlbWVudCAoaWYgeW91IGhhdmUgc2V0IGBmYWlsX29uX2dlb19taXNtYXRjaGApLlxyXG4gICAgICogICAgVGhvc2UgbWVhc3VyZW1lbnRzIGNhbiBiZSB1c2VkIGFsc28gdG8gZ2VuZXJhbCBpbXByb3ZlbWVudCBvZiB0aGUgc2VjdXJpdHkuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29yaWdpbl0gVGhlIG9yaWdpbiBkb21haW4gb2YgdGhlIHJlcXVlc3QgYmVpbmcgbWFkZS4gSWYgYG51bGxgIHRoZW4gdGhlIFJlZmVyZXIgaGVhZGVyIHdpbGwgYmUgdXNlZC5cclxuICAgICAqIEB0aHJvd3MgV3JvbmdKc29uRXJyb3IsIE9wZW5BcGlFcnJvciwgUmVzb3VyY2VOb3RGb3VuZEVycm9yLCBPVFBHZW5lcmF0aW9uRXJyb3IsIFVua25vd25FcnJvclxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0gVGhlIEN5YmVydXMgS2V5IHNlc3Npb24gaWQuXHJcbiAgICAgKiBAbWVtYmVyb2YgQ3liZXJ1c0tleUFQSVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYXN5bmMgY3JlYXRlU2Vzc2lvbihjbGllbnRJZDogc3RyaW5nLCBvcmlnaW4/OiBzdHJpbmcsIGdlbz86IEdlb2xvY2F0aW9uKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHtjbGllbnRfaWQ6IGNsaWVudElkfTtcclxuXHJcbiAgICAgICAgaWYgKGdlbykge1xyXG4gICAgICAgICAgICBkYXRhWydsYXQnXSA9IGdlby5sYXRpdHVkZTtcclxuICAgICAgICAgICAgZGF0YVsnbG5nJ10gPSBnZW8ubG9uZ2l0dWRlO1xyXG4gICAgICAgIH0gZWxzZSBpZih0aGlzLl9nZW9Qcm92aWRlcil7XHJcbiAgICAgICAgICAgIGNvbnN0IGdwcyA9IGF3YWl0IHRoaXMuX2dlb1Byb3ZpZGVyLmdldEdlbygpO1xyXG4gICAgICAgICAgICBpZiAoZ3BzKXtcclxuICAgICAgICAgICAgICAgIGRhdGFbJ2xhdCddID0gZ3BzLmxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgZGF0YVsnbG5nJ10gPSBncHMubG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob3JpZ2luKSB7XHJcbiAgICAgICAgICAgIGRhdGFbJ29yaWdpbiddID0gb3JpZ2luO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgYm9keTogdGhpcy5fZ2V0VXJsRW5jb2RlZEJvZHkoZGF0YSksXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX2dldFVybCgnc2Vzc2lvbnMnKSwgcGFyYW1zKVxyXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgLnRoZW4oKGpzb24pID0+IGpzb24uZGF0YS5zZXNzaW9uX2lkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENoZWNrcyBpZiBhdXRoZW50aWNhdGlvbiBzZXJ2ZXIgaXMgYXZhaWxhYmxlXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IGZsYWcgaW5kaWNhdGluZyBpZiB0aGUgYXV0aGVudGljYXRpb24gc2VydmVyIGlzIGF2YWlsYWJsZS5cclxuICAgICAqIEBtZW1iZXJvZiBDeWJlcnVzS2V5QVBJXHJcbiAgICAgKi9cclxuXHJcblxyXG4gICAgcHVibGljIGFzeW5jIGlzT3V0T2ZTZXJ2aWNlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG5cclxuXHJcbiAgICAgICAgbGV0IGVyclBhZ2VNc2cgPSAobmV3IFVSTChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKSkuc2VhcmNoUGFyYW1zLmdldChcImVycm9yXCIpO1xyXG5cclxuICAgICAgICBpZiAoZXJyUGFnZU1zZyAhPW51bGwgJiYgZXJyUGFnZU1zZyA9PSBcIm90cF90aW1lb3V0X2Vycm9yXCIpe1xyXG4gICAgICAgICAgICBsZXQgYXV0aEFjdGl2ZSA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJhdXRoX2FjdGl2ZVwiKTtcclxuICAgICAgICAgICAgaWYgKGF1dGhBY3RpdmUgIT1udWxsICYmIGF1dGhBY3RpdmUgPT09IFwidHJ1ZVwiKXtcclxuICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oXCJhdXRoX2FjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICAgIGxldCBhdXRoQ291bnRlciA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJhdXRoX2NvdW50ZXJcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXV0aENvdW50ZXIhPW51bGwpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBhdXRoQ291bnRlclZhbHVlID0gcGFyc2VJbnQoYXV0aENvdW50ZXIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4oYXV0aENvdW50ZXJWYWx1ZSkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwiYXV0aF9jb3VudGVyXCIsIChhdXRoQ291bnRlclZhbHVlICsgMSkudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcImF1dGhfY291bnRlclwiLCBcIjFcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShcImF1dGhfY291bnRlclwiKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpbnRlcmZhY2UgVmVyc2lvblJlc3BvbnNlIHtcclxuICAgICAgICAgICAgdmVyc2lvbjogc3RyaW5nO1xyXG4gICAgICAgICAgICBtaW5Nb2JpbGVWZXJzaW9uOiBzdHJpbmc7XHJcbiAgICAgICAgICAgIG1heE1vYmlsZVZlcnNpb246IHN0cmluZztcclxuICAgICAgICAgICAgb3V0T2ZTZXJ2aWNlOiBib29sZWFuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9nZXRVcmwoYHZlcnNpb25gKSwgcmVxdWVzdE9wdGlvbnMpXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgLnRoZW4oKHZlcnNpb25Kc29uOiBWZXJzaW9uUmVzcG9uc2UpID0+IHZlcnNpb25Kc29uLm91dE9mU2VydmljZSlcclxuICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnI7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgVVJMIHdpdGggc291bmQgd2l0aCBlbWJlZGRlZCBPVFAuIFlvdSBoYXZlIHRvIGVtaXQgaXQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtTZXNzaW9ufSBzZXNzaW9uIEN5YmVydXMgS2V5J3Mgc2Vzc2lvbiBnZW5lcmF0ZWQgYnkgYSB1c2VyIGZvciBhIGxvZ2luLlxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0gc3RyaW5nIHdpdGggdXJsIHRvIHRoZSBzb3VuZC5cclxuICAgICAqIEB0aHJvd3MgUmVzb3VyY2VOb3RGb3VuZEVycm9yXHJcbiAgICAgKiBAbWVtYmVyb2YgQ3liZXJ1c0tleUFQSVxyXG4gICAgICovXHJcblxyXG5cclxuICAgIHB1YmxpYyBnZXRPVFBTb3VuZChzZXNzaW9uOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSAnYXVkaW8vbXBlZyc7XHJcbiAgICAgICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICdBY2NlcHQnOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L3BsYWluJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX2dldFVybChgc2Vzc2lvbnMvJHtzZXNzaW9ufWApLCByZXF1ZXN0T3B0aW9ucylcclxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5hcnJheUJ1ZmZlcigpKVxyXG4gICAgICAgICAgICAudGhlbigoYXJyYXlCdWZmZXIpID0+IG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHt0eXBlOiB0eXBlfSkpXHJcbiAgICAgICAgICAgIC50aGVuKChibG9iKSA9PiB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSlcclxuICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnI7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIE9wZW5JRCdzIEF1dGhlbnRpY2F0aW9uIGVuZHBvaW50IFVSTCB3aGljaCB3aWxsIGJlIHVzZWQgdG8gcHJvY2VzcyB0aGUgYXV0aGVudGljYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNlc3Npb25JZCB1bmlxdWUgaWQgY3JlYXRlZCBmb3IgdGhlIHNwZWNpZmljIGxvZ2luIGFuZCBjb25uZWN0ZWQgdG8gdGhlIHNwZWNpZmljIG90cFxyXG4gICAgICogQHBhcmFtIHtPcGVuSWRTY29wZVBhcnNlcn0gc2NvcGUgRWFjaCBzY29wZSByZXR1cm5zIGEgc2V0IG9mIHVzZXIgYXR0cmlidXRlcywgd2hpY2ggYXJlIGNhbGxlZCBjbGFpbXMuXHJcbiAgICAgKiAgICBPbmNlIHRoZSB1c2VyIGF1dGhvcml6ZXMgdGhlIHJlcXVlc3RlZCBzY29wZXMsIHRoZSBjbGFpbXMgYXJlIHJldHVybmVkIGluIGFuIElEIFRva2VuLlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNsaWVudElkIFB1YmxpYyBjbGllbnQgSUQgZ2VuZXJhdGVkIGR1cmluZyBjcmVhdGluZyB0aGUgYWNjb3VudC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSByZWRpcmVjdFVyaSBSZWRpcmVjdCBVUkkgdG8gd2hpY2ggdGhlIHJlc3BvbnNlIHdpbGwgYmUgc2VudC4gSWYgdGhlIHZhbHVlIGlzIG5vdCB3aGl0ZWxpc3RlZCB0aGVuIHRoZSByZXF1ZXN0IHdpbGwgZmFpbC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RhdGVdXHJcbiAgICAgKiAgICBSRUNPTU1FTkRFRC4gT3BhcXVlIHZhbHVlIHVzZWQgdG8gbWFpbnRhaW4gc3RhdGUgYmV0d2VlbiB0aGUgcmVxdWVzdCBhbmQgdGhlIGNhbGxiYWNrLiBUeXBpY2FsbHksIENTUkYsIFhTUkYgbWl0aWdhdGlvbiBpcyBkb25lIGJ5IGNyeXB0b2dyYXBoaWNhbGx5IGJpbmRpbmcgdGhlIHZhbHVlIG9mIHRoaXMgcGFyYW1ldGVyIHdpdGggYSBicm93c2VyIGNvb2tpZS5cclxuICAgICAqICAgIFRoZSBzdGF0ZSBwYXJhbWV0ZXIgcHJlc2VydmVzIHNvbWUgc3RhdGUgb2JqZWN0IHNldCBieSB0aGUgY2xpZW50IGluIHRoZSBBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGFuZCBtYWtlcyBpdCBhdmFpbGFibGUgdG8gdGhlIGNsaWVudCBpbiB0aGUgcmVzcG9uc2UuXHJcbiAgICAgKiAgICBJdOKAmXMgdGhhdCB1bmlxdWUgYW5kIG5vbi1ndWVzc2FibGUgdmFsdWUgdGhhdCBhbGxvd3MgeW91IHRvIHByZXZlbnQgdGhlIGF0dGFjayBieSBjb25maXJtaW5nIGlmIHRoZSB2YWx1ZSBjb21pbmcgZnJvbSB0aGUgcmVzcG9uc2UgbWF0Y2hlcyB0aGUgb25lIHlvdSBleHBlY3QgKHRoZSBvbmUgeW91IGdlbmVyYXRlZCB3aGVuIGluaXRpYXRpbmcgdGhlIHJlcXVlc3QpLlxyXG4gICAgICogICAgVGhlIHN0YXRlIHBhcmFtZXRlciBpcyBhIHN0cmluZyBzbyB5b3UgY2FuIGVuY29kZSBhbnkgb3RoZXIgaW5mb3JtYXRpb24gaW4gaXQuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW25vbmNlXVxyXG4gICAgICogICAgU3RyaW5nIHZhbHVlIHVzZWQgdG8gYXNzb2NpYXRlIGEgQ2xpZW50IHNlc3Npb24gd2l0aCBhbiBJRCBUb2tlbiwgYW5kIHRvIG1pdGlnYXRlIHJlcGxheSBhdHRhY2tzLlxyXG4gICAgICogICAgVGhlIHZhbHVlIGlzIHBhc3NlZCB0aHJvdWdoIHVubW9kaWZpZWQgZnJvbSB0aGUgQXV0aGVudGljYXRpb24gUmVxdWVzdCB0byB0aGUgSUQgVG9rZW4uXHJcbiAgICAgKiAgICBTdWZmaWNpZW50IGVudHJvcHkgTVVTVCBiZSBwcmVzZW50IGluIHRoZSBub25jZSB2YWx1ZXMgdXNlZCB0byBwcmV2ZW50IGF0dGFja2VycyBmcm9tIGd1ZXNzaW5nIHZhbHVlcy5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbcmVzcG9uc2VUeXBlPSdjb2RlJ10gT3BlbklkIHJlc3BvbnNlIHR5cGUuIFRoZSBkZWZhdWx0IGlzIGBjb2RlYCAoQ29kZSBGbG93LCBpbnZvbHZpbmcgdGhlIGZyb250LWNoYW5uZWwgYW5kIGJhY2tjaGFubmVsKS5cclxuICAgICAqIEByZXR1cm5zIE9wZW5JRCdzIEF1dGhlbnRpY2F0aW9uIGVuZHBvaW50IFVSTFxyXG4gICAgICogQHRocm93cyBJbnZhbGlkUmVkaXJlY3RVcmlFcnJvciwgSW52YWxpZENsaWVudEVycm9yLCBSZXNvdXJjZU5vdEZvdW5kRXJyb3JcclxuICAgICAqIEBtZW1iZXJvZiBDeWJlcnVzS2V5QVBJXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRBdXRoZW50aWNhdGlvbkVuZHBvaW50VXJsKHNlc3Npb25JZDogc3RyaW5nLCBzY29wZTogT3BlbklkU2NvcGVQYXJzZXIsIGNsaWVudElkOiBzdHJpbmcsIHJlZGlyZWN0VXJpOiBzdHJpbmcsIHN0YXRlPzogc3RyaW5nLCBub25jZT86IHN0cmluZywgcmVzcG9uc2VUeXBlID0gJ2NvZGUnKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBkYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgICAgIHNlc3Npb25faWQ6IHNlc3Npb25JZCxcclxuICAgICAgICAgICAgY2xpZW50X2lkOiBjbGllbnRJZCxcclxuICAgICAgICAgICAgc2NvcGU6IHNjb3BlLmdldFZhbHVlKCksXHJcbiAgICAgICAgICAgIHJlZGlyZWN0X3VyaTogcmVkaXJlY3RVcmksXHJcbiAgICAgICAgICAgIHJlc3BvbnNlX3R5cGU6IHJlc3BvbnNlVHlwZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICBkYXRhWydzdGF0ZSddID0gc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChub25jZSkge1xyXG4gICAgICAgICAgICBkYXRhWydub25jZSddID0gbm9uY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHRoaXMuX2dldFVybCgnYXV0aGVudGljYXRlJykpO1xyXG5cclxuICAgICAgICBPYmplY3Qua2V5cyhkYXRhKS5mb3JFYWNoKChwYXJhbWV0ZXJOYW1lKSA9PiB7XHJcbiAgICAgICAgICAgIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKHBhcmFtZXRlck5hbWUsIGRhdGFbcGFyYW1ldGVyTmFtZV0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdXJsLmhyZWY7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTmF2aWdhdGVzIHRvIEF1dGhlbnRpY2F0aW9uIEVuZHBvaW50XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNsaWVudElkIFB1YmxpYyBjbGllbnQgSUQgZ2VuZXJhdGVkIGR1cmluZyBjcmVhdGluZyB0aGUgYWNjb3VudC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSByZWRpcmVjdFVyaSBSZWRpcmVjdCBVUkkgdG8gd2hpY2ggdGhlIHJlc3BvbnNlIHdpbGwgYmUgc2VudC4gSWYgdGhlIHZhbHVlIGlzIG5vdCB3aGl0ZWxpc3RlZCB0aGVuIHRoZSByZXF1ZXN0IHdpbGwgZmFpbC5cclxuICAgICAqIEBwYXJhbSB7T3BlbklkU2NvcGVQYXJzZXJ9IHNjb3BlIEVhY2ggc2NvcGUgcmV0dXJucyBhIHNldCBvZiB1c2VyIGF0dHJpYnV0ZXMsIHdoaWNoIGFyZSBjYWxsZWQgY2xhaW1zLlxyXG4gICAgICogICAgT25jZSB0aGUgdXNlciBhdXRob3JpemVzIHRoZSByZXF1ZXN0ZWQgc2NvcGVzLCB0aGUgY2xhaW1zIGFyZSByZXR1cm5lZCBpbiBhbiBJRCBUb2tlbi5cclxuICAgICAqIEBwYXJhbSB7TmF2aWdhdG9yfSBuYXZpZ2F0b3IgQ2xhc3MgZGVzY3JpYmVzIGFuIGFjdGlvbiB0aGF0IHdpbGwgYmUgZG9uZSB0byBBdXRoZW50aWNhdGlvbiBVUkwuIEZvciBicm93c2VycyBpdCB3aWxsIGJlIGEgcGFnZSByZWRpcmVjdGlvbi5cclxuICAgICAqIEBwYXJhbSBzZXNzaW9uIFNlc3Npb24gaWRcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3JpZ2luXSBUaGUgb3JpZ2luIGRvbWFpbiBvZiB0aGUgcmVxdWVzdCBiZWluZyBtYWRlLiBJZiBgbnVsbGAgdGhlbiB0aGUgUmVmZXJlciBoZWFkZXIgd2lsbCBiZSB1c2VkLlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdGF0ZV1cclxuICAgICAqICAgIFJFQ09NTUVOREVELiBPcGFxdWUgdmFsdWUgdXNlZCB0byBtYWludGFpbiBzdGF0ZSBiZXR3ZWVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgY2FsbGJhY2suIFR5cGljYWxseSwgQ1NSRiwgWFNSRiBtaXRpZ2F0aW9uIGlzIGRvbmUgYnkgY3J5cHRvZ3JhcGhpY2FsbHkgYmluZGluZyB0aGUgdmFsdWUgb2YgdGhpcyBwYXJhbWV0ZXIgd2l0aCBhIGJyb3dzZXIgY29va2llLlxyXG4gICAgICogICAgVGhlIHN0YXRlIHBhcmFtZXRlciBwcmVzZXJ2ZXMgc29tZSBzdGF0ZSBvYmplY3Qgc2V0IGJ5IHRoZSBjbGllbnQgaW4gdGhlIEF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgYW5kIG1ha2VzIGl0IGF2YWlsYWJsZSB0byB0aGUgY2xpZW50IGluIHRoZSByZXNwb25zZS5cclxuICAgICAqICAgIEl04oCZcyB0aGF0IHVuaXF1ZSBhbmQgbm9uLWd1ZXNzYWJsZSB2YWx1ZSB0aGF0IGFsbG93cyB5b3UgdG8gcHJldmVudCB0aGUgYXR0YWNrIGJ5IGNvbmZpcm1pbmcgaWYgdGhlIHZhbHVlIGNvbWluZyBmcm9tIHRoZSByZXNwb25zZSBtYXRjaGVzIHRoZSBvbmUgeW91IGV4cGVjdCAodGhlIG9uZSB5b3UgZ2VuZXJhdGVkIHdoZW4gaW5pdGlhdGluZyB0aGUgcmVxdWVzdCkuXHJcbiAgICAgKiAgICBUaGUgc3RhdGUgcGFyYW1ldGVyIGlzIGEgc3RyaW5nIHNvIHlvdSBjYW4gZW5jb2RlIGFueSBvdGhlciBpbmZvcm1hdGlvbiBpbiBpdC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbbm9uY2VdXHJcbiAgICAgKiAgICBTdHJpbmcgdmFsdWUgdXNlZCB0byBhc3NvY2lhdGUgYSBDbGllbnQgc2Vzc2lvbiB3aXRoIGFuIElEIFRva2VuLCBhbmQgdG8gbWl0aWdhdGUgcmVwbGF5IGF0dGFja3MuXHJcbiAgICAgKiAgICBUaGUgdmFsdWUgaXMgcGFzc2VkIHRocm91Z2ggdW5tb2RpZmllZCBmcm9tIHRoZSBBdXRoZW50aWNhdGlvbiBSZXF1ZXN0IHRvIHRoZSBJRCBUb2tlbi5cclxuICAgICAqICAgIFN1ZmZpY2llbnQgZW50cm9weSBNVVNUIGJlIHByZXNlbnQgaW4gdGhlIG5vbmNlIHZhbHVlcyB1c2VkIHRvIHByZXZlbnQgYXR0YWNrZXJzIGZyb20gZ3Vlc3NpbmcgdmFsdWVzLlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtyZXNwb25zZVR5cGU9J2NvZGUnXSBPcGVuSWQgcmVzcG9uc2UgdHlwZS4gVGhlIGRlZmF1bHQgaXMgYGNvZGVgIChDb2RlIEZsb3csIGludm9sdmluZyB0aGUgZnJvbnQtY2hhbm5lbCBhbmQgYmFja2NoYW5uZWwpLlxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XHJcbiAgICAgKiBAbWVtYmVyb2YgQ3liZXJ1c0tleUFQSVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbmF2aWdhdGVBdXRoZW50aWNhdGlvbihjbGllbnRJZDogc3RyaW5nLCByZWRpcmVjdFVyaTogc3RyaW5nLCBzY29wZTogT3BlbklkU2NvcGVQYXJzZXIsIG5hdmlnYXRvcjogTmF2aWdhdG9yLCBzZXNzaW9uOiBzdHJpbmcsIG9yaWdpbj86IHN0cmluZywgc3RhdGU/OiBzdHJpbmcsIG5vbmNlPzogc3RyaW5nLCByZXNwb25zZVR5cGUgPSAnY29kZScpIHtcclxuICAgICAgICBjb25zdCBhdXRoZW50aWNhdGVVcmwgPSB0aGlzLmdldEF1dGhlbnRpY2F0aW9uRW5kcG9pbnRVcmwoc2Vzc2lvbiwgc2NvcGUsIGNsaWVudElkLCByZWRpcmVjdFVyaSwgc3RhdGUsIG5vbmNlLCByZXNwb25zZVR5cGUpO1xyXG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJhdXRoX2FjdGl2ZVwiLCBcInRydWVcIik7XHJcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5uYXZpZ2F0ZShhdXRoZW50aWNhdGVVcmwpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhc3luYyBsb2dpblRocm91Z2hDeWJlcnVzS2V5RGFzaGJvYXJkKG9wdGlvbnM6IExvZ2luT3B0aW9ucyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIGNvbnN0IGRhdGE6IGFueSA9IHtcclxuICAgICAgICAgICAgY2xpZW50X2lkOiBvcHRpb25zLmNsaWVudElkLFxyXG4gICAgICAgICAgICBzY29wZTogb3B0aW9ucy5zY29wZS5nZXRWYWx1ZSgpLFxyXG4gICAgICAgICAgICByZWRpcmVjdF91cmk6IG9wdGlvbnMucmVkaXJlY3RVcmksXHJcbiAgICAgICAgICAgIHJlc3BvbnNlX3R5cGU6IG9wdGlvbnMucmVzcG9uc2VUeXBlLFxyXG4gICAgICAgICAgICBzdGF0ZTogb3B0aW9ucy5zdGF0ZSxcclxuICAgICAgICAgICAgbm9uY2U6IG9wdGlvbnMubm9uY2UsXHJcbiAgICAgICAgICAgIGRpc3BsYXk6IG9wdGlvbnMuZGlzcGxheSB8fCAncGFnZScsXHJcbiAgICAgICAgICAgIHByb21wdDogb3B0aW9ucy5wcm9tcHQsXHJcbiAgICAgICAgICAgIHRoZW1lOiBvcHRpb25zLnRoZW1lLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zLnN0YXRlKSB7XHJcbiAgICAgICAgICAgIGRhdGFbJ3N0YXRlJ10gPSBvcHRpb25zLnN0YXRlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMubm9uY2UpIHtcclxuICAgICAgICAgICAgZGF0YVsnbm9uY2UnXSA9IG9wdGlvbnMubm9uY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHRoaXMuX2dldFVybCgnYXV0aGVudGljYXRlJykpO1xyXG5cclxuICAgICAgICBPYmplY3Qua2V5cyhkYXRhKS5mb3JFYWNoKChwYXJhbWV0ZXJOYW1lKSA9PiB7XHJcbiAgICAgICAgICAgIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKHBhcmFtZXRlck5hbWUsIGRhdGFbcGFyYW1ldGVyTmFtZV0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBhd2FpdCBvcHRpb25zLm5hdmlnYXRvci5uYXZpZ2F0ZSh1cmwuaHJlZik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0VXJsKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIChuZXcgVVJMKHBhdGgsIHRoaXMuX2FwaVVybCkpLmhyZWY7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0VXJsRW5jb2RlZEJvZHkoZGF0YTogYW55KTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoZGF0YSkucmVkdWNlPHN0cmluZ1tdPigocmVzdWx0OiBzdHJpbmdbXSwga2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZW5jb2RlZEtleSA9IGVuY29kZVVSSUNvbXBvbmVudChrZXkpO1xyXG4gICAgICAgICAgICBjb25zdCBlbmNvZGVkVmFsdWUgPSBlbmNvZGVVUklDb21wb25lbnQoZGF0YVtrZXldKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGAke2VuY29kZWRLZXl9PSR7ZW5jb2RlZFZhbHVlfWApO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9LCBbXSkuam9pbihcIiZcIilcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF90aW1lb3V0KG1zOiBudW1iZXIpOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChyZXNvbHZlLCBtcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIiwiZW51bSBFcnJvckNvZGUge1xyXG4gIHVuZGVmaW5lZCA9IDEsXHJcbiAgdW5rbm93bl9lcnJvcixcclxuICBzZXJ2ZXJfZXJyb3IsXHJcbiAgd3JvbmdfanNvbixcclxuICBvcGVuYXBpX2Vycm9yLFxyXG4gIHJlc291cmNlX25vdF9mb3VuZCxcclxuICBvdHBfZ2VuZXJhdGlvbl9mYWlsdXJlLFxyXG4gIGludmFsaWRfcmVkaXJlY3RfdXJpLFxyXG4gIGludmFsaWRfY2xpZW50LFxyXG4gIHRvb19tYW55X2NhbGxzX2Vycm9yXHJcbn1cclxuXHJcbmNsYXNzIEN5YmVydXNLZXlFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICBwcml2YXRlIF9jb2RlOiBFcnJvckNvZGU7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNvZGU6IGtleW9mIHR5cGVvZiBFcnJvckNvZGUsIG1lc3NhZ2U6IHN0cmluZykge1xyXG4gICAgc3VwZXIobWVzc2FnZSlcclxuICAgIHRoaXMuX2NvZGUgPSBFcnJvckNvZGVbY29kZV07XHJcbiAgfVxyXG5cclxuICBnZXQgY29kZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIEVycm9yQ29kZVt0aGlzLl9jb2RlXTtcclxuICB9XHJcblxyXG4gIGdldCBkZXNjcmlwdGlvbigpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMubWVzc2FnZTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFVua25vd25FcnJvciBleHRlbmRzIEN5YmVydXNLZXlFcnJvciB7XHJcbiAgY29uc3RydWN0b3IoY29kZToga2V5b2YgdHlwZW9mIEVycm9yQ29kZSA9ICd1bmtub3duX2Vycm9yJywgbWVzc2FnZTogc3RyaW5nID0gJ1Vua25vd24gZXJyb3Igb2NjdXJlZC4nKSB7XHJcbiAgICBzdXBlcihjb2RlLCBtZXNzYWdlKVxyXG4gIH1cclxufVxyXG5jbGFzcyBUb29NYW55Q2FsbHNFcnJvciBleHRlbmRzIEN5YmVydXNLZXlFcnJvciB7XHJcbiAgY29uc3RydWN0b3IoY29kZToga2V5b2YgdHlwZW9mIEVycm9yQ29kZSA9ICd0b29fbWFueV9jYWxsc19lcnJvcicsIG1lc3NhZ2U6IHN0cmluZyA9ICdZb3VcXCd2ZSBkb25lIHRvbyBtYW55IGNhbGxzLicpIHtcclxuICAgIHN1cGVyKGNvZGUsIG1lc3NhZ2UpXHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBNaXNzaW5nUmVkaXJlY3RVcmkgZXh0ZW5kcyBDeWJlcnVzS2V5RXJyb3Ige1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoJ2ludmFsaWRfcmVkaXJlY3RfdXJpJywgJ01pc3NpbmcgcmVkaXJlY3Rpb24gVVJJLicpO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgV3JvbmdKc29uRXJyb3IgZXh0ZW5kcyBDeWJlcnVzS2V5RXJyb3IgeyB9XHJcbmNsYXNzIE9wZW5BcGlFcnJvciBleHRlbmRzIEN5YmVydXNLZXlFcnJvciB7IH1cclxuY2xhc3MgUmVzb3VyY2VOb3RGb3VuZEVycm9yIGV4dGVuZHMgQ3liZXJ1c0tleUVycm9yIHsgfVxyXG5jbGFzcyBPVFBHZW5lcmF0aW9uRXJyb3IgZXh0ZW5kcyBDeWJlcnVzS2V5RXJyb3IgeyB9XHJcbmNsYXNzIEludmFsaWRSZWRpcmVjdFVyaUVycm9yIGV4dGVuZHMgQ3liZXJ1c0tleUVycm9yIHsgfVxyXG5jbGFzcyBJbnZhbGlkQ2xpZW50RXJyb3IgZXh0ZW5kcyBDeWJlcnVzS2V5RXJyb3IgeyB9XHJcblxyXG5jb25zdCBNQVBQSU5HID0ge1xyXG4gIFtFcnJvckNvZGUudW5kZWZpbmVkXTogVW5rbm93bkVycm9yLFxyXG4gIFtFcnJvckNvZGUudW5rbm93bl9lcnJvcl06IFVua25vd25FcnJvcixcclxuICBbRXJyb3JDb2RlLnNlcnZlcl9lcnJvcl06IFVua25vd25FcnJvcixcclxuICBbRXJyb3JDb2RlLnVuZGVmaW5lZF06IFdyb25nSnNvbkVycm9yLFxyXG4gIFtFcnJvckNvZGUud3JvbmdfanNvbl06IFdyb25nSnNvbkVycm9yLFxyXG4gIFtFcnJvckNvZGUub3BlbmFwaV9lcnJvcl06IE9wZW5BcGlFcnJvcixcclxuICBbRXJyb3JDb2RlLnJlc291cmNlX25vdF9mb3VuZF06IFJlc291cmNlTm90Rm91bmRFcnJvcixcclxuICBbRXJyb3JDb2RlLm90cF9nZW5lcmF0aW9uX2ZhaWx1cmVdOiBPVFBHZW5lcmF0aW9uRXJyb3IsXHJcbiAgW0Vycm9yQ29kZS5pbnZhbGlkX3JlZGlyZWN0X3VyaV06IEludmFsaWRSZWRpcmVjdFVyaUVycm9yLFxyXG4gIFtFcnJvckNvZGUuaW52YWxpZF9jbGllbnRdOiBJbnZhbGlkQ2xpZW50RXJyb3IsXHJcbiAgW0Vycm9yQ29kZS50b29fbWFueV9jYWxsc19lcnJvcl06IFRvb01hbnlDYWxsc0Vycm9yXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGVycm9yRmFjdG9yeShjb2RlOiBrZXlvZiB0eXBlb2YgRXJyb3JDb2RlLCBtZXNzYWdlOiBzdHJpbmcpIHtcclxuICBjb25zdCBlbnVtX3R5cGUgPSBFcnJvckNvZGVbY29kZV07XHJcbiAgY29uc3QgRXJyb3JDb25zdHJ1Y3RvciA9IE1BUFBJTkdbZW51bV90eXBlXTtcclxuXHJcbiAgcmV0dXJuIG5ldyBFcnJvckNvbnN0cnVjdG9yKGNvZGUsIG1lc3NhZ2UpO1xyXG59XHJcblxyXG5leHBvcnQge1xyXG4gIGVycm9yRmFjdG9yeSxcclxuICBFcnJvckNvZGUsXHJcbiAgQ3liZXJ1c0tleUVycm9yLFxyXG4gIFVua25vd25FcnJvcixcclxuICBUb29NYW55Q2FsbHNFcnJvcixcclxuICBXcm9uZ0pzb25FcnJvcixcclxuICBPcGVuQXBpRXJyb3IsXHJcbiAgUmVzb3VyY2VOb3RGb3VuZEVycm9yLFxyXG4gIE9UUEdlbmVyYXRpb25FcnJvcixcclxuICBNaXNzaW5nUmVkaXJlY3RVcmlcclxufTtcclxuXHJcbiIsIi8qKlxyXG4gKiBBbiBhYnN0cmFjdGlvbiBmb3IgYSB0YWtlbiBnZW9sb2NhdGlvbiBtZWFzdXJlbWVudC5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAY2xhc3MgR2VvbG9jYXRpb25cclxuICovXHJcbmV4cG9ydCBjbGFzcyBHZW9sb2NhdGlvbiB7XHJcbiAgcHJpdmF0ZSBfbGF0aXR1ZGU6IG51bWJlcjtcclxuICBwcml2YXRlIF9sb25naXR1ZGU6IG51bWJlcjtcclxuICBwcml2YXRlIF9hY2N1cmFjeTogbnVtYmVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcihsYXRpdHVkZTogbnVtYmVyLCBsb25naXR1ZGU6IG51bWJlciwgYWNjdXJhY3k/OiBudW1iZXIpIHtcclxuICAgIHRoaXMuX2xhdGl0dWRlID0gbGF0aXR1ZGU7XHJcbiAgICB0aGlzLl9sb25naXR1ZGUgPSBsb25naXR1ZGU7XHJcbiAgICB0aGlzLl9hY2N1cmFjeSA9IGFjY3VyYWN5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGEgbGF0aXR1ZGUuXHJcbiAgICpcclxuICAgKiBAcmVhZG9ubHlcclxuICAgKiBAdHlwZSB7bnVtYmVyfVxyXG4gICAqIEBtZW1iZXJvZiBHZW9sb2NhdGlvblxyXG4gICAqL1xyXG4gIGdldCBsYXRpdHVkZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xhdGl0dWRlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyBhIGxvbmdpdHVkZS5cclxuICAgKlxyXG4gICAqIEByZWFkb25seVxyXG4gICAqIEB0eXBlIHtudW1iZXJ9XHJcbiAgICogQG1lbWJlcm9mIEdlb2xvY2F0aW9uXHJcbiAgICovXHJcbiAgZ2V0IGxvbmdpdHVkZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xvbmdpdHVkZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgYW4gYWNjdXJhY3kgb2YgYSBtZWFzdXJlbWVudC5cclxuICAgKlxyXG4gICAqIEByZWFkb25seVxyXG4gICAqIEB0eXBlIHtudW1iZXJ9XHJcbiAgICogQG1lbWJlcm9mIEdlb2xvY2F0aW9uXHJcbiAgICovXHJcbiAgZ2V0IGFjY3VyYWN5KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fYWNjdXJhY3k7XHJcbiAgfVxyXG59IiwiZXhwb3J0ICogZnJvbSAnLi9zZGsvYXBpJztcclxuZXhwb3J0ICogZnJvbSAnLi9zZGsvZXJyb3JzJztcclxuZXhwb3J0ICogZnJvbSAnLi9zZGsvbmF2aWdhdG9yL25hdmlnYXRvcic7XHJcbmV4cG9ydCAqIGZyb20gJy4vc2RrL25hdmlnYXRvci9yZWRpcmVjdE5hdmlnYXRvcic7XHJcbmV4cG9ydCAqIGZyb20gJy4vc2RrL3Njb3BlUGFyc2VyJztcclxuZXhwb3J0ICogZnJvbSAnLi9zZGsvc2Vzc2lvbic7XHJcbmV4cG9ydCAqIGZyb20gJy4vc2RrL2dlb1Byb3ZpZGVyL2dlbyc7XHJcbmV4cG9ydCAqIGZyb20gJy4vc2RrL2dlb1Byb3ZpZGVyL2dlb1Byb3ZpZGVyJztcclxuZXhwb3J0ICogZnJvbSAnLi9zZGsvZ2VvUHJvdmlkZXIvaHRtbDVHZW9Qcm92aWRlcic7XHJcbmV4cG9ydCAqIGZyb20gJy4vc2RrL2xvZ2luT3B0aW9ucyc7XHJcblxyXG5pbXBvcnQgeyBDeWJlcnVzS2V5QVBJIH0gZnJvbSAnLi9zZGsvYXBpJztcclxuZXhwb3J0IGRlZmF1bHQgQ3liZXJ1c0tleUFQSTsiLCJpbXBvcnQgeyBNaXNzaW5nUmVkaXJlY3RVcmkgfSBmcm9tICcuLi9lcnJvcnMnO1xyXG5pbXBvcnQgeyBOYXZpZ2F0b3IgfSBmcm9tICcuL25hdmlnYXRvcic7XHJcblxyXG5cclxuLyoqXHJcbiAqIENsYXNzIGRlc2NyaWJlcyBob3cgT3BlbklEJ3MgQXV0aGVudGljYXRpb24gRW5kcG9pbnQgd2lsbCBiZSBoYW5kbGVkLlxyXG4gKiBUaGlzIGNsYXNzIGlzIHRoaWdodGVuIHRvIGEgZGVmYXVsdCBicm93c2VyIGJlaGF2aW91ciBmb3IgT3BlbklEIHByb3RvY29sIC0gYSByZWRpcmVjdGlvbi5cclxuICogV2hpY2ggbWVhbnMgdGhhdCB5b3VyIFVSTCB3aWxsIGJlIHRlbXBvcmFyaWx5IHJlcGxhY2VkIGJ5IHRoZSBBdXRoZW50aWNhdGlvbiBFbmRwb2ludFxyXG4gKiBhbmQgcmVwbGFjZWQgYWdhaW4gYnkgaXRzIHJlc3BvbnNlIC0gSFRUUCAzMDIuIFRoZSBuZXcgbG9jYXRpb24gd2lsbCBiZSB0aGUgb25lIHlvdSBkZWZpbmVkIGFzIHlvdXIgYHJlZGlyZWN0X3VyaWAuXHJcbiAqIFxyXG4gKiBAZXhwb3J0XHJcbiAqIEBjbGFzcyBSZWRpcmVjdE5hdmlnYXRvclxyXG4gKiBAaW1wbGVtZW50cyB7TmF2aWdhdG9yfVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFJlZGlyZWN0TmF2aWdhdG9yIGltcGxlbWVudHMgTmF2aWdhdG9yIHtcclxuICAvKipcclxuICAgKiBOYXZpZ2F0ZXMgdG8gdGhlIGdpdmVuIFVSTC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQXV0aGVudGljYXRpb24gRW5kcG9pbnQgVVJMLlxyXG4gICAqIEB0aHJvd3MgTWlzc2luZ1JlZGlyZWN0VXJpXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XHJcbiAgICogQG1lbWJlcm9mIFJlZGlyZWN0TmF2aWdhdG9yXHJcbiAgICovXHJcbiAgYXN5bmMgbmF2aWdhdGUodXJsOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICghdXJsKSB7XHJcbiAgICAgIHRocm93IG5ldyBNaXNzaW5nUmVkaXJlY3RVcmkoKVxyXG4gICAgfVxyXG5cclxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsO1xyXG5cclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICB9XHJcbn0iLCJcclxuLyoqXHJcbiAqIEhhbmR5IGNsYXNzIHRvIGRlZmluZSBhbiBPcGVuSUQncyBzY29wZS5cclxuICogU2NvcGVzIGFyZSB1c2VkIGJ5IGFuIGFwcGxpY2F0aW9uIGR1cmluZyBhdXRoZW50aWNhdGlvbiB0byBhdXRob3JpemUgYWNjZXNzIHRvIGEgdXNlcidzIGRldGFpbHMsXHJcbiAqIGxpa2UgbmFtZSBhbmQgcGljdHVyZS4gRWFjaCBzY29wZSByZXR1cm5zIGEgc2V0IG9mIHVzZXIgYXR0cmlidXRlcywgd2hpY2ggYXJlIGNhbGxlZCBjbGFpbXMuIFxyXG4gKiBcclxuICogWW91IGNhbiB1c2UgYWRkaXRpb25hbCB2YWx1ZXMgYGVtYWlsYCAoYWRkIGEgdXNlcidzIGVtYWlsIGNsYWltKSBhbmQgYHByb2ZpbGVgIChhZGQgdXNlciBmaXJzdCBhbmQgbGFzdCBuYW1lKS5cclxuICogXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogY29uc3Qgc2NvcGVQYXJzZXIgPSBuZXcgT3BlbklkU2NvcGVQYXJzZXIoKTtcclxuICogY29uc3Qgc2NvcGUgPSBzY29wZVBhcnNlci5hZGRFbWFpbCgpLmFkZFByb2ZpbGUoKS5nZXRWYWx1ZSgpO1xyXG4gKiBgYGBcclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAY2xhc3MgT3BlbklkU2NvcGVQYXJzZXJcclxuICovXHJcbmV4cG9ydCBjbGFzcyBPcGVuSWRTY29wZVBhcnNlciB7XHJcbiAgcHJpdmF0ZSBfc2NvcGU6IEFycmF5PHN0cmluZz47XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5fc2NvcGUgPSBbJ29wZW5pZCddO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkcyBgZW1haWxgIHNjb3BlLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge3RoaXN9XHJcbiAgICogQG1lbWJlcm9mIE9wZW5JZFNjb3BlUGFyc2VyXHJcbiAgICovXHJcbiAgcHVibGljIGFkZEVtYWlsKCk6IHRoaXMge1xyXG4gICAgaWYgKHRoaXMuX3Njb3BlLmluY2x1ZGVzKCdlbWFpbCcpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX3Njb3BlLnB1c2goJ2VtYWlsJyk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGBwcm9maWxlYCBzY29wZS5cclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHt0aGlzfVxyXG4gICAqIEBtZW1iZXJvZiBPcGVuSWRTY29wZVBhcnNlclxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRQcm9maWxlKCk6IHRoaXMge1xyXG4gICAgaWYgKHRoaXMuX3Njb3BlLmluY2x1ZGVzKCdwcm9maWxlJykpIHtcclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fc2NvcGUucHVzaCgncHJvZmlsZScpO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyBmb3JtYXR0ZWQgc2NvcGUgdmFsdWUsIGUuZy4gYG9wZW5pZCBlbWFpbGAuXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAqIEBtZW1iZXJvZiBPcGVuSWRTY29wZVBhcnNlclxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Njb3BlLmpvaW4oJyAnKTtcclxuICB9XHJcbn0iLCJleHBvcnQgaW50ZXJmYWNlIFNlc3Npb25SZXNwb25zZSB7XHJcbiAgc2Vzc2lvbl9pZDogc3RyaW5nO1xyXG4gIGNyZWF0ZWRfYXQ6IHN0cmluZztcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBEYXRhIGNsYXNzIHJlcHJlc2VudGluZyBhIEN5YmVydXMgS2V5IHNlc3Npb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGNsYXNzIFNlc3Npb25cclxuICovXHJcbmV4cG9ydCBjbGFzcyBTZXNzaW9uIHtcclxuICAvKipcclxuICAgKiBTZXNzaW9uJ3MgdW5pcXVlIGlkZW50aWZpZXIuIEl0J3MgdmFsaWQgdXAgdG8gMjBzLlxyXG4gICAqXHJcbiAgICogQHR5cGUge3N0cmluZ31cclxuICAgKiBAbWVtYmVyb2YgU2Vzc2lvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXNzaW9uSWQ6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICogQSBVVEMgZGF0ZSByZXByZXNlbnRpbmcgYSBkYXRlIChhbmQgdGltZSkgd2hlbiBhIHNlc3Npb24gaGFzIGJlZW4gY3JlYXRlZC5cclxuICAgKlxyXG4gICAqIEB0eXBlIHtEYXRlfVxyXG4gICAqIEBtZW1iZXJvZiBTZXNzaW9uXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZWRBdDogRGF0ZTtcclxuXHJcbiAgY29uc3RydWN0b3IoanNvbjogU2Vzc2lvblJlc3BvbnNlKSB7XHJcbiAgICB0aGlzLnNlc3Npb25JZCA9IGpzb24uc2Vzc2lvbl9pZDtcclxuICAgIHRoaXMuY3JlYXRlZEF0ID0gbmV3IERhdGUoanNvbi5jcmVhdGVkX2F0KTtcclxuICB9XHJcbn0iLCJpbXBvcnQge0dlb2xvY2F0aW9ufSBmcm9tICcuL2dlbyc7XHJcbmltcG9ydCB7R2VvUHJvdmlkZXJ9IGZyb20gJy4vZ2VvUHJvdmlkZXInO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBDbGFzcyBwcm92aWRlcyBhIGdlb2xvY2FsaXphdGlvbiBtZWFzdXJlbWVudC5cclxuICogSXQgdXNlcyBhIEhUTUw1J3MgYEdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbigpYCBtZXRob2QuXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGNsYXNzIEhUTUw1R2VvUHJvdmlkZXJcclxuICogQGltcGxlbWVudHMge0dlb1Byb3ZpZGVyfVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEhUTUw1R2VvUHJvdmlkZXIgaW1wbGVtZW50cyBHZW9Qcm92aWRlciB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9lbmFibGVIaWdoQWNjdXJhY3k6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIF9uYXZpZ2F0b3I6IE5hdmlnYXRvcjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX251bU9mVHJpZXNCZWZvcmVHcHNBY3RpdmF0ZXM6IG51bWJlciA9IDI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9vblBlcm1pc3Npb25EaWFsb2c/OiBGdW5jdGlvbjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGVmYXVsdE1lc3NhZ2UgPSBcIkN5YmVydXMgS2V5IHdpZGdldCB3b3VsZCBsaWtlIHRvIGFjY2VzcyB5b3VyIGxvY2F0aW9uXCIgK1xyXG4gICAgICAgIFwiIHRvIHVzZSBnZW9sb2NhdGlvbiB0cmFja2luZyB0byBhc3NlcnQgc3VjY2Vzc2Z1bCBhdXRoZW50aWNhdGlvbi5cIlxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBIVE1MNUdlb1Byb3ZpZGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2VuYWJsZUhpZ2hBY2N1cmFjeT1mYWxzZV0gIEZvcmNlcyBoaWdoIGFjY3VyYWN5IG9mIHRoZSBnZW9sb2NhdGlvbi4gSXQgbWF5IHRha2UgbG9uZ2VyLlxyXG4gICAgICogQHBhcmFtIHtOYXZpZ2F0b3J9IFtuYXZpZ2F0b3I9d2luZG93Lm5hdmlnYXRvcl1cclxuICAgICAqIEBwYXJhbSBudW1PZlRyaWVzQmVmb3JlR3BzQWN0aXZhdGVzIFRoZSBHUFMgbG9jYWxpemF0aW9uIHdpbGwgYmUgdXNlZCBvbmx5IGFmdGVyIG4gdW5zdWNjZXNzZnVsIHRyaWVzLlxyXG4gICAgICogQnkgdW5zdWNjZXNzZnVsIHRyeSB3ZSBkZWZpbmUgdGhlIG51bWJlciBvZiB0aW1lcyB0aGUgYXV0aGVudGljYXRpb24gcmVzdWx0ZWQgaW4gc2Vzc2lvbiBub3QgZm91bmQgZXJyb3IuXHJcbiAgICAgKiBAcGFyYW0gb25QZXJtaXNzaW9uRGlhbG9nIExlYXZlIGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGRpYWxvZyB0byBhcHBlYXIgYmVmb3JlIHNpdGVcclxuICAgICAqIGFza3MgZm9yIGxvY2FsaXphdGlvbiBwZXJtaXNzaW9uIGZvciB0aGUgY2FsbGVyIHRvIGhhbmRsZS4gSXQgdGFrZXMgYSBmdW5jdGlvbiB3aXRoIGRlZmF1bHQgbWVzc2FnZSBhcyBwYXJhbWV0ZXJcclxuICAgICAqIEBtZW1iZXJvZiBIVE1MNUdlb1Byb3ZpZGVyXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGVuYWJsZUhpZ2hBY2N1cmFjeSA9IGZhbHNlLCBvblBlcm1pc3Npb25EaWFsb2c6IEZ1bmN0aW9uID0gbnVsbCwgbnVtT2ZUcmllc0JlZm9yZUdwc0FjdGl2YXRlczogbnVtYmVyID0gMiwgbmF2aWdhdG9yOiBOYXZpZ2F0b3IgPSB3aW5kb3cubmF2aWdhdG9yKSB7XHJcbiAgICAgICAgdGhpcy5fZW5hYmxlSGlnaEFjY3VyYWN5ID0gZW5hYmxlSGlnaEFjY3VyYWN5O1xyXG4gICAgICAgIHRoaXMuX25hdmlnYXRvciA9IG5hdmlnYXRvcjtcclxuICAgICAgICB0aGlzLl9udW1PZlRyaWVzQmVmb3JlR3BzQWN0aXZhdGVzID0gbnVtT2ZUcmllc0JlZm9yZUdwc0FjdGl2YXRlcztcclxuICAgICAgICB0aGlzLl9vblBlcm1pc3Npb25EaWFsb2cgPSBvblBlcm1pc3Npb25EaWFsb2c7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGdlb2xvY2FsaXphdGlvbiBtZWFzdXJlbWVudC5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxHZW9sb2NhdGlvbj59IEdlb2xvY2FsaXphdGlvbiBtZWFzdXJlbWVudC5cclxuICAgICAqIEBtZW1iZXJvZiBIVE1MNUdlb1Byb3ZpZGVyXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGdldEdlbygpOiBQcm9taXNlPEdlb2xvY2F0aW9uPiB7XHJcblxyXG4gICAgICAgIGNvbnN0IHBlcm1pc3Npb25TdGF0dXMgPSBhd2FpdCBuYXZpZ2F0b3IucGVybWlzc2lvbnMucXVlcnkoe1xyXG4gICAgICAgICAgICBuYW1lOiAnZ2VvbG9jYXRpb24nXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChwZXJtaXNzaW9uU3RhdHVzLnN0YXRlID09IFwiZ3JhbnRlZFwiKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX2dldEdlbyh0aGlzLl9lbmFibGVIaWdoQWNjdXJhY3kpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBlcm1pc3Npb25TdGF0dXMuc3RhdGUgPT0gXCJkZW5pZWRcIilcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBlcm1pc3Npb25TdGF0dXMuc3RhdGUgPT0gXCJwcm9tcHRcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9kb0lTaG93Q3VzdG9tUHJvbXB0KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29uUGVybWlzc2lvbkRpYWxvZylcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblBlcm1pc3Npb25EaWFsb2codGhpcy5kZWZhdWx0TWVzc2FnZSlcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBhbGVydCh0aGlzLmRlZmF1bHRNZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fZ2V0R2VvKHRoaXMuX2VuYWJsZUhpZ2hBY2N1cmFjeSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIF9kb0lTaG93Q3VzdG9tUHJvbXB0KCkge1xyXG4gICAgICAgIGxldCBkYXRhID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcImF1dGhfY291bnRlclwiKTtcclxuICAgICAgICBpZiAoZGF0YSA9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGxldCB2YWx1ZSA9IHBhcnNlSW50KGRhdGEsIDEwKVxyXG5cclxuICAgICAgICByZXR1cm4gIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSA+PSB0aGlzLl9udW1PZlRyaWVzQmVmb3JlR3BzQWN0aXZhdGVzO1xyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgX2dldEdlbyhlbmFibGVIaWdoQWNjdXJhY3k6IGJvb2xlYW4pOiBQcm9taXNlPEdlb2xvY2F0aW9uPiB7XHJcbiAgICAgICAgY29uc3Qge2Nvb3Jkc30gPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX25hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24ocmVzb2x2ZSwgcmVqZWN0LCB7ZW5hYmxlSGlnaEFjY3VyYWN5fSlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBHZW9sb2NhdGlvbihjb29yZHMubGF0aXR1ZGUsIGNvb3Jkcy5sb25naXR1ZGUsIGNvb3Jkcy5hY2N1cmFjeSk7XHJcblxyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IE5hdmlnYXRvciB9IGZyb20gJy4vbmF2aWdhdG9yL25hdmlnYXRvcic7XHJcbmltcG9ydCB7IE9wZW5JZFNjb3BlUGFyc2VyIH0gZnJvbSAnLi9zY29wZVBhcnNlcic7XHJcblxyXG5cclxuLyoqXHJcbiAqIExvZ2luIG9wdGlvbnMuXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGNsYXNzIExvZ2luT3B0aW9uc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIExvZ2luT3B0aW9ucyB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNsaWVudElkIFB1YmxpYyBjbGllbnQgSUQgZ2VuZXJhdGVkIGR1cmluZyBjcmVhdGluZyB0aGUgYWNjb3VudC5cclxuICAgKlxyXG4gICAqIEB0eXBlIHtzdHJpbmd9XHJcbiAgICogQG1lbWJlcm9mIExvZ2luT3B0aW9uc1xyXG4gICAqL1xyXG4gIHJlYWRvbmx5IGNsaWVudElkOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWRpcmVjdFVyaSBSZWRpcmVjdCBVUkkgdG8gd2hpY2ggdGhlIHJlc3BvbnNlIHdpbGwgYmUgc2VudC4gSWYgdGhlIHZhbHVlIGlzIG5vdCB3aGl0ZWxpc3RlZCB0aGVuIHRoZSByZXF1ZXN0IHdpbGwgZmFpbC5cclxuICAgKlxyXG4gICAqIEB0eXBlIHtzdHJpbmd9XHJcbiAgICogQG1lbWJlcm9mIExvZ2luT3B0aW9uc1xyXG4gICAqL1xyXG4gIHJlYWRvbmx5IHJlZGlyZWN0VXJpOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7T3BlbklkU2NvcGVQYXJzZXJ9IHNjb3BlIEVhY2ggc2NvcGUgcmV0dXJucyBhIHNldCBvZiB1c2VyIGF0dHJpYnV0ZXMsIHdoaWNoIGFyZSBjYWxsZWQgY2xhaW1zLlxyXG4gICAqICAgIE9uY2UgdGhlIHVzZXIgYXV0aG9yaXplcyB0aGUgcmVxdWVzdGVkIHNjb3BlcywgdGhlIGNsYWltcyBhcmUgcmV0dXJuZWQgaW4gYW4gSUQgVG9rZW4uXHJcbiAgICpcclxuICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAqIEBtZW1iZXJvZiBMb2dpbk9wdGlvbnNcclxuICAgKi9cclxuICByZWFkb25seSBzY29wZTogT3BlbklkU2NvcGVQYXJzZXI7XHJcblxyXG4gIC8qKlxyXG4gICogQHBhcmFtIHtOYXZpZ2F0b3J9IG5hdmlnYXRvciBDbGFzcyBkZXNjcmliZXMgYW4gYWN0aW9uIHRoYXQgd2lsbCBiZSBkb25lIHRvIEF1dGhlbnRpY2F0aW9uIFVSTC4gRm9yIGJyb3dzZXJzIGl0IHdpbGwgYmUgYSBwYWdlIHJlZGlyZWN0aW9uLlxyXG4gICAqXHJcbiAgICogQHR5cGUge3N0cmluZ31cclxuICAgKiBAbWVtYmVyb2YgTG9naW5PcHRpb25zXHJcbiAgICovXHJcbiAgcmVhZG9ubHkgbmF2aWdhdG9yOiBOYXZpZ2F0b3I7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbb3JpZ2luXSBUaGUgb3JpZ2luIGRvbWFpbiBvZiB0aGUgcmVxdWVzdCBiZWluZyBtYWRlLiBJZiBgbnVsbGAgdGhlbiB0aGUgUmVmZXJlciBoZWFkZXIgd2lsbCBiZSB1c2VkLlxyXG4gICAqXHJcbiAgICogQHR5cGUge3N0cmluZ31cclxuICAgKiBAbWVtYmVyb2YgTG9naW5PcHRpb25zXHJcbiAgICovXHJcbiAgcmVhZG9ubHkgb3JpZ2luOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RhdGVdXHJcbiAgICogICAgUkVDT01NRU5ERUQuIE9wYXF1ZSB2YWx1ZSB1c2VkIHRvIG1haW50YWluIHN0YXRlIGJldHdlZW4gdGhlIHJlcXVlc3QgYW5kIHRoZSBjYWxsYmFjay4gVHlwaWNhbGx5LCBDU1JGLCBYU1JGIG1pdGlnYXRpb24gaXMgZG9uZSBieSBjcnlwdG9ncmFwaGljYWxseSBiaW5kaW5nIHRoZSB2YWx1ZSBvZiB0aGlzIHBhcmFtZXRlciB3aXRoIGEgYnJvd3NlciBjb29raWUuXHJcbiAgICogICAgVGhlIHN0YXRlIHBhcmFtZXRlciBwcmVzZXJ2ZXMgc29tZSBzdGF0ZSBvYmplY3Qgc2V0IGJ5IHRoZSBjbGllbnQgaW4gdGhlIEF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgYW5kIG1ha2VzIGl0IGF2YWlsYWJsZSB0byB0aGUgY2xpZW50IGluIHRoZSByZXNwb25zZS5cclxuICAgKiAgICBJdOKAmXMgdGhhdCB1bmlxdWUgYW5kIG5vbi1ndWVzc2FibGUgdmFsdWUgdGhhdCBhbGxvd3MgeW91IHRvIHByZXZlbnQgdGhlIGF0dGFjayBieSBjb25maXJtaW5nIGlmIHRoZSB2YWx1ZSBjb21pbmcgZnJvbSB0aGUgcmVzcG9uc2UgbWF0Y2hlcyB0aGUgb25lIHlvdSBleHBlY3QgKHRoZSBvbmUgeW91IGdlbmVyYXRlZCB3aGVuIGluaXRpYXRpbmcgdGhlIHJlcXVlc3QpLlxyXG4gICAqICAgIFRoZSBzdGF0ZSBwYXJhbWV0ZXIgaXMgYSBzdHJpbmcgc28geW91IGNhbiBlbmNvZGUgYW55IG90aGVyIGluZm9ybWF0aW9uIGluIGl0LlxyXG4gICAqXHJcbiAgICogQHR5cGUge3N0cmluZ31cclxuICAgKiBAbWVtYmVyb2YgTG9naW5PcHRpb25zXHJcbiAgICovXHJcbiAgcmVhZG9ubHkgc3RhdGU6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtub25jZV1cclxuICAgKiAgICBTdHJpbmcgdmFsdWUgdXNlZCB0byBhc3NvY2lhdGUgYSBDbGllbnQgc2Vzc2lvbiB3aXRoIGFuIElEIFRva2VuLCBhbmQgdG8gbWl0aWdhdGUgcmVwbGF5IGF0dGFja3MuXHJcbiAgICogICAgVGhlIHZhbHVlIGlzIHBhc3NlZCB0aHJvdWdoIHVubW9kaWZpZWQgZnJvbSB0aGUgQXV0aGVudGljYXRpb24gUmVxdWVzdCB0byB0aGUgSUQgVG9rZW4uXHJcbiAgICogICAgU3VmZmljaWVudCBlbnRyb3B5IE1VU1QgYmUgcHJlc2VudCBpbiB0aGUgbm9uY2UgdmFsdWVzIHVzZWQgdG8gcHJldmVudCBhdHRhY2tlcnMgZnJvbSBndWVzc2luZyB2YWx1ZXMuXHJcbiAgICpcclxuICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAqIEBtZW1iZXJvZiBMb2dpbk9wdGlvbnNcclxuICAgKi9cclxuICByZWFkb25seSBub25jZTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gW3Jlc3BvbnNlVHlwZT0nY29kZSddIE9wZW5JZCByZXNwb25zZSB0eXBlLiBUaGUgZGVmYXVsdCBpcyBgY29kZWAgKENvZGUgRmxvdywgaW52b2x2aW5nIHRoZSBmcm9udC1jaGFubmVsIGFuZCBiYWNrY2hhbm5lbCkuXHJcbiAgICpcclxuICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAqIEBtZW1iZXJvZiBMb2dpbk9wdGlvbnNcclxuICAgKi9cclxuICByZWFkb25seSByZXNwb25zZVR5cGU6IHN0cmluZyA9ICdjb2RlJztcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRpc3BsYXkgSXQgc3BlY2lmaWVzIGhvdyB0aGUgQXV0aG9yaXphdGlvbiBTZXJ2ZXIgZGlzcGxheXMgdGhlIGF1dGhlbnRpY2F0aW9uIGFuZCBjb25zZW50IHVzZXIgaW50ZXJmYWNlIHBhZ2VzIHRvIHRoZSBFbmQtVXNlci5cclxuICAgKiAgIERlZmF1bHQgYW5kIHRoZSBvbmx5IHN1cHBvcnRlZCB2YWx1ZSBpcyBgcGFnZWAuXHJcbiAgICpcclxuICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAqIEBtZW1iZXJvZiBMb2dpbk9wdGlvbnNcclxuICAgKi9cclxuICByZWFkb25seSBkaXNwbGF5OiBzdHJpbmcgPSAncGFnZSdcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHByb21wdCBTcGFjZSBkZWxpbWl0ZWQsIGNhc2Ugc2Vuc2l0aXZlIGxpc3Qgb2Ygc3RyaW5nIHZhbHVlcyB0aGF0IHNwZWNpZmllcyB3aGV0aGVyIHRoZSBBdXRob3JpemF0aW9uIFNlcnZlclxyXG4gICAqICAgcHJvbXB0cyB0aGUgRW5kLVVzZXIgZm9yIHJlYXV0aGVudGljYXRpb24gYW5kIGNvbnNlbnQuIFRoZSBkZWZpbmVkIHZhbHVlcyBhcmU6IGBsb2dpbmAsIGBub25lYC5cclxuICAgKiAgIERlZmF1bHQgaXMgYGxvZ2luLG5vbmVgLiBDYW4ndCBiZSBjaGFuZ2VkIGZvciBub3cuXHJcbiAgICpcclxuICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAqIEBtZW1iZXJvZiBMb2dpbk9wdGlvbnNcclxuICAgKi9cclxuICByZWFkb25seSBwcm9tcHQ6IHN0cmluZyA9ICdsb2dpbixub25lJ1xyXG5cclxuICAvKipcclxuICAgKiBUaGVtZSBvZiB0aGUgbG9naW4gcGFnZSBvZiBDeWJlcnVzIEtleSBEYXNoYm9hcmQuIERlZmF1bHQgaXMgYGRlZmF1bHRgLlxyXG4gICAqXHJcbiAgICogQHR5cGUge3N0cmluZ31cclxuICAgKiBAbWVtYmVyb2YgTG9naW5PcHRpb25zXHJcbiAgICovXHJcbiAgcmVhZG9ubHkgdGhlbWU6IHN0cmluZyA9ICdkZWZhdWx0JztcclxufSJdLCJzb3VyY2VSb290IjoiIn0=